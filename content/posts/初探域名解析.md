---
title: 初探域名解析
tags:
  - DNS
url: 63.html
id: 63
categories:
  - network
date: 2019-03-31 14:18:43
---

最近发现在 aws 上有 12 个月免费使用的 ec2 主机，于是就注册了一个，顺便搭建了这个博客。但是，一个好的博客不能总是用 IP 来访问的嘛。于是就在 godaddy 上买了一个域名，并且在阿里云的云解析上注册了 dns 解析，之后就可以用域名来访问本博客了。这时候有个疑问就出来了，为什么购买了域名，并且注册了 dns 解析后就可以在本地浏览器访问博客了呢？

浏览器如何找到域名对应的 IP
---------------

当我们在浏览器的地址栏输入某个域名发起请求时，操作系统会通过最近的 dns 服务器查找域名对应的 IP 地址，比如我现在是用的电脑配置的 dns 服务器为 8.8.8.8。如果电脑没有设置 dns 服务器，那么会默认向路由器发起查询请求。

最近的 dns 服务器收到查询请求后，会先在本地缓存查找是否有域名对应的信息，如果有的话，将会直接返回对应的域名信息，否则，dns 服务器会向**根域名服务器**发起请求。根域名服务器会从上到下查找域名信息，直到找到对应的域名信息或者找不到对应的域名信息返回错误。

操作系统收到 dns 服务器的应答后，会做出对应的行为，比如访问对应的服务器或者返回给浏览器对应的错误。

域名服务器
-----

上面提到一个概念叫做**根域名服务器。**那么，什么是域名服务器，什么是根域名服务器呢？ 为什么需要域名？

### 域名

大家都知道，点分式的 IP 地址由 4 段数字和 3 的英文句点组成，比如 192.168.125.47，这样的地址有点不好记忆，如果换成 foobar.com 这样的域名就会比较好记忆了。而映射域名和 IP 地址之间关系的就是域名服务器了。

### 域名服务器

域名服务器是通过一个表来记录域名和 IP 的映射关系的，表中大概有四个字段：域名，class，记录类型以及响应数据

*   **域名**：显而易见，这个字段是记录需要查找的域名的名字的。
*   **class**：用来识别网络的信息，比如互联网是用 IN 来表示的（现在似乎也只有互联网了）。
*   **记录类型**：用来表示域名对用何种类型的记录。比如，如果域名对应的是某个 IP，那么，它的记录类型就是 A (address)。除了 A 记录之外，还有很多其他的记录类型，大家可以通过该 [WIKI](https://en.wikipedia.org/wiki/List_of_DNS_record_types) 了解。
*   **响应数据**：该字段则是表示返回给客户端的对应信息。比如，通过域名访问本博客的话，返回的就是本博客的地址了。

### 域名的层级结构

那么，根域名服务器又是什么呢？大家可能会想到，如果我把所有的域名映射信息都放在本地，那么不就不需要复杂的域名查询流程了吗？但是，互联网上的域名实在是太多了，不可能放在一台服务器上的，于是就有了分层的域名结构，而不同分层的域名信息就可以放在不同的服务器上了（虽然也可以放在同一台服务器上）。比如，本博客的 www.tech-seeker.cn 就分为四个层级，分别是 www 域、tech-seeker 域、cn 域以及根域。大家可能会疑惑：前面三个域好理解，根域怎么又是怎么回事？其实，一个完整的域名是以英文句点结尾的，如：www.tech-seeker.cn. 。这个英文句点就是代表根域，但是通常都会将其省略。

小结
--

当设备访问某个域名时，它会向最近的 dns 服务器发起查询。最近的 dns 服务器找不到对用的域名信息的时候，它就会向根域名服务器发起查询，然后，根域名服务器会根据域名的分层来查找对应的域名信息。然后返回给最近的 dns 服务器，dns服务器会将域名信息缓存在本地并且返回给发起访问的设备。

这是我第一次发表技术博客，可能还是有点杂乱，后面会保持至少一周一篇的节奏分享工作或者学习上的所得和疑问。希望能在分享的同时，更加深刻地巩固自己的所得。